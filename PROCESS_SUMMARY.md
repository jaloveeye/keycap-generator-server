# 키캡 이미지 생성 프로세스 요약

## 전체 프로세스

### 1. 클라이언트 (Flutter 앱)

1. **이미지 선택**: 사용자가 이미지를 선택
2. **색상 추출**: 이미지에서 대표 색상 5개 추출
3. **GMK 매칭**: 추출된 색상을 가장 유사한 GMK 색상 코드로 매칭
4. **키캡 검색**: 매칭된 GMK 색상 코드로 기존 키캡 검색
5. **색상 선택** (구현 필요): 키캡 생성 시 실제 색상(hex) 또는 매칭된 GMK 색상 코드 선택
6. **서버 요청**: 선택한 색상을 hex 값으로 서버에 전송

### 2. 서버 (Next.js)

7. **색상 처리**: 
   - hex 값이면 그대로 사용
   - GMK 코드면 표준 hex 값으로 변환
8. **colorGroups 생성**: 키캡 레이아웃 데이터를 참고하여 색상 그룹 생성
9. **프롬프트 생성**: DALL-E 프롬프트 생성 (TKL WKL 7U 레이아웃)
10. **이미지 생성**: OpenAI DALL-E API로 이미지 생성
11. **저장**: Supabase Storage에 이미지 저장, Database에 메타데이터 저장

### 3. 클라이언트 응답

12. **결과 확인**: 생성된 이미지 URL과 colorGroups 정보 수신

## colorGroups 응답 형식

### GMK 색상 코드를 사용한 경우:
```json
{
  "id": "alpha",
  "approx": "CR",
  "legend": "N9",
  "approxType": "gmk",
  "legendType": "gmk"
}
```

### hex 값을 사용한 경우:
```json
{
  "id": "alpha",
  "approx": "#889012",
  "legend": "#ff0000",
  "approxType": "hex",
  "legendType": "hex"
}
```

## 현재 구현 상태

- ✅ 1-4단계: 완료
- ⚠️ 5단계: UI 구현 필요 (실제 색상 vs GMK 색상 선택)
- ✅ 6-11단계: 완료
- ✅ 12단계: 완료

## 개선 필요 사항

1. **클라이언트 UI**: 키캡 생성 시 "실제 색상 사용" / "GMK 색상 코드 사용" 선택 옵션 추가
2. **응답 형식**: `approxType`, `legendType` 필드 추가 (선택적)

